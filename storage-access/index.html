<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Storage Access API Embedded Tester Site B</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height: 1.45; margin: 0; padding: 18px; }
    h1,h2 { margin: 0 0 10px 0; }
    p { margin: 8px 0; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }
    .card { border: 1px solid rgba(127,127,127,0.28); border-radius: 14px; padding: 12px; margin: 12px 0; background: rgba(127,127,127,0.06); }
    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid rgba(127,127,127,0.35);
      background: rgba(127,127,127,0.12);
      color: inherit;
      cursor: pointer;
    }
    button:hover { background: rgba(127,127,127,0.18); }
    pre { padding: 12px; border-radius: 10px; overflow: auto; background: rgba(127,127,127,0.14); margin: 0; }
    .small { opacity: 0.85; }
    .ok { border-color: rgba(0,160,0,0.6); }
    .no { border-color: rgba(200,0,0,0.6); }
  </style>
</head>
<body>
  <h1 id="title">Storage Access API Embedded Tester Site B</h1>

  <div class="card" id="primaryStatus"></div>

  <div class="card" id="explain"></div>

  <div class="card" id="actionCard" style="display:none;">
    <button id="run">Run test</button>
    <div class="small">
      This calls <span class="mono">document.requestStorageAccess()</span> if supported, then rechecks visibility of the seeded state.
    </div>
  </div>

  <div class="card">
    <pre id="out"></pre>
  </div>

  <script>
    function main() {
      const ORIGIN_A = "https://test-website-a.pages.dev";

      const outEl = document.getElementById("out");
      const primaryEl = document.getElementById("primaryStatus");
      const explainEl = document.getElementById("explain");
      const actionCard = document.getElementById("actionCard");

      function post(type, payload) {
        try {
          if (window.parent && window.parent !== window) {
            window.parent.postMessage({ type, ...payload }, ORIGIN_A);
          }
        } catch {}
      }

      function line(s) {
        outEl.textContent += s + "\n";
        post("line", { line: s });
      }

      function setPrimary(message, ok) {
        primaryEl.className = "card " + (ok ? "ok" : "no");
        primaryEl.innerHTML = "<b>" + message + "</b>";
        post("status", { message });
      }

      function cookieMap() {
        const out = {};
        const raw = document.cookie || "";
        raw.split(";").map(s => s.trim()).filter(Boolean).forEach(pair => {
          const i = pair.indexOf("=");
          const k = i >= 0 ? pair.slice(0, i) : pair;
          const v = i >= 0 ? pair.slice(i + 1) : "";
          out[decodeURIComponent(k)] = decodeURIComponent(v);
        });
        return out;
      }

      function setCookie(name, value) {
        document.cookie =
          encodeURIComponent(name) + "=" + encodeURIComponent(value) +
          "; Path=/; Max-Age=31536000; SameSite=None; Secure";
      }

      function randHex(nBytes) {
        try {
          const a = new Uint8Array(nBytes);
          crypto.getRandomValues(a);
          return Array.from(a).map(x => x.toString(16).padStart(2, "0")).join("");
        } catch {
          return Math.random().toString(16).slice(2) + Math.random().toString(16).slice(2);
        }
      }

      function lsGet(k) {
        try { return { ok: true, v: localStorage.getItem(k) }; }
        catch (e) { return { ok: false, err: (e?.name || "Error") + ": " + (e?.message || String(e)) }; }
      }

      function lsSet(k, v) {
        try { localStorage.setItem(k, v); return { ok: true }; }
        catch (e) { return { ok: false, err: (e?.name || "Error") + ": " + (e?.message || String(e)) }; }
      }

      async function hasStorageAccess() {
        if (typeof document.hasStorageAccess !== "function") return { supported: false, value: null, e

